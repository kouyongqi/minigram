<!--pages/me/me.wxml-->

<!-- 导航栏 -->
<view class="nav-bar">
  <text class="nav-title">个人中心</text>
  <view class="nav-right">
    <text class="nav-icon">⚙️</text>
  </view>
</view>

<!-- 主内容区 -->
<scroll-view class="main-content" scroll-y enhanced="true" bounces="true" show-scrollbar="false">
  <!-- 用户资料卡片 -->
  <view class="user-card">
    <!-- 已登录状态 -->
    <view class="user-info" wx:if="{{isLogin}}">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="user-details">
        <view class="name-badge">
          <text class="user-name">{{userInfo.nickName}}</text>
          <text class="user-badge">{{userGrade}}</text>
        </view>
        <text class="user-school">{{userSchool}}</text>
        <text class="user-class">{{userClass}}</text>
      </view>
      <button class="edit-btn" bindtap="editProfile">编辑资料</button>
    </view>
    
    <!-- 未登录状态 -->
    <view class="login-section" wx:else>
      <view class="login-avatar-section">
        <button class="avatar-btn" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
          <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        </button>
      </view>
      <view class="login-info">
        <view class="login-tips">登录后可同步学习数据，参与排行榜</view>
        <button class="wechat-btn" bindtap="navigateToLogin">
          <text class="wechat-btn-icon">🔐</text> 登录/注册
        </button>
      </view>
    </view>
    
    <view class="user-stats">
      <view class="stat-item">
        <text class="stat-value">{{streak}}</text>
        <text class="stat-label">连续天数</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{points}}</text>
        <text class="stat-label">积分</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{ranking}}</text>
        <text class="stat-label">排名</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{medals}}</text>
        <text class="stat-label">勋章</text>
      </view>
    </view>
  </view>
  
  <!-- 功能区域 -->
  <view class="feature-section">
    <view class="feature-grid">
      <view class="feature-item" bindtap="navigateTo" data-url="../mistake/list">
        <view class="feature-icon feature-icon-red">📕</view>
        <text class="feature-text">错题本</text>
      </view>
      <view class="feature-item" bindtap="navigateTo" data-url="../favorite/list">
        <view class="feature-icon feature-icon-blue">⭐</view>
        <text class="feature-text">收藏</text>
      </view>
      <view class="feature-item" bindtap="navigateTo" data-url="../history/list">
        <view class="feature-icon feature-icon-green">🕒</view>
        <text class="feature-text">历史记录</text>
      </view>
      <view class="feature-item" bindtap="navigateTo" data-url="../download/list">
        <view class="feature-icon feature-icon-purple">📥</view>
        <text class="feature-text">下载</text>
      </view>
    </view>
  </view>
  
  <!-- 学习数据 -->
  <view class="stats-section">
    <text class="section-title">学习数据</text>
    <view class="subject-stats">
      <view class="subject-item">
        <view class="subject-header">
          <text class="subject-name">数学</text>
          <text class="subject-meta">{{mathStats.completed}}题 · {{mathStats.correctRate}}%正确率</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill progress-blue" style="width: {{mathStats.correctRate}}%"></view>
        </view>
      </view>
      
      <view class="subject-item">
        <view class="subject-header">
          <text class="subject-name">物理</text>
          <text class="subject-meta">{{physicsStats.completed}}题 · {{physicsStats.correctRate}}%正确率</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill progress-purple" style="width: {{physicsStats.correctRate}}%"></view>
        </view>
      </view>
      
      <view class="subject-item">
        <view class="subject-header">
          <text class="subject-name">化学</text>
          <text class="subject-meta">{{chemistryStats.completed}}题 · {{chemistryStats.correctRate}}%正确率</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill progress-green" style="width: {{chemistryStats.correctRate}}%"></view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 商城会员 -->
  <view class="vip-section" bindtap="showVipDetails">
    <view class="vip-icon">👑</view>
    <view class="vip-info">
      <text class="vip-title">开通会员享更多特权</text>
      <text class="vip-desc">海量题库、课程、答疑、思维导图...</text>
    </view>
    <button class="vip-btn">了解详情</button>
  </view>
  
  <!-- 其他选项列表 -->
  <view class="options-list">
    <view class="option-item" bindtap="navigateTo" data-url="../invite/index">
      <text class="option-icon">👥</text>
      <text class="option-text">邀请好友</text>
      <text class="option-arrow">></text>
    </view>
    
    <view class="option-item" bindtap="navigateTo" data-url="../feedback/index">
      <text class="option-icon">💬</text>
      <text class="option-text">意见反馈</text>
      <text class="option-arrow">></text>
    </view>
    
    <view class="option-item" bindtap="contactService">
      <text class="option-icon">🎧</text>
      <text class="option-text">联系客服</text>
      <text class="option-arrow">></text>
    </view>
    
    <view class="option-item" bindtap="navigateTo" data-url="../about/index">
      <text class="option-icon">ℹ️</text>
      <text class="option-text">关于我们</text>
      <text class="option-arrow">></text>
    </view>
    
    <view class="option-item" bindtap="navigateTo" data-url="../settings/index">
      <text class="option-icon">⚙️</text>
      <text class="option-text">设置</text>
      <text class="option-arrow">></text>
    </view>
  </view>
  
  <!-- 底部安全区域占位 -->
  <view class="safe-area-bottom"></view>
</scroll-view>